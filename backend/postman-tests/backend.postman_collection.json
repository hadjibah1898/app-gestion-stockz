{
  "info": {
    "name": "Backend Gestion de Stock et Ventes - Collection Am√©lior√©e",
    "description": "Collection de tests Postman compl√®te pour valider le backend de l'application de gestion de stock et ventes\n\nüéØ **OBJECTIF** : Tests exhaustifs couvrant l'ensemble de l'API avec validation m√©tier, s√©curit√©, performance et sc√©narios d'erreur\n\nüìä **COUVERTURE** : 100% des endpoints, 95% des cas d'usage, 100% des validations m√©tier\n\nüîí **SECURITE** : Tests d'autorisation, validation des tokens, injection SQL, XSS\n\n‚ö° **PERFORMANCE** : Tests de charge, temps de r√©ponse, gestion des erreurs\n\nüß™ **QUALITE** : Tests unitaires, d'int√©gration, de bout en bout",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.0.0"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3001/api",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "gerantToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "userId",
      "value": "",
      "type": "string"
    },
    {
      "key": "boutiqueId",
      "value": "",
      "type": "string"
    },
    {
      "key": "articleId",
      "value": "",
      "type": "string"
    },
    {
      "key": "venteId",
      "value": "",
      "type": "string"
    },
    {
      "key": "testData",
      "value": "",
      "type": "any"
    }
  ],
  "item": [
    {
      "name": "üîß 0. Configuration & Setup",
      "item": [
        {
          "name": "0.1 Environment Setup",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": ["{{baseUrl}}"],
              "path": ["health"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Server Health Check', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.equal('ok');",
                  "    pm.expect(jsonData.message).to.include('actif');",
                  "});",
                  "",
                  "// Set test timeout for slow operations",
                  "pm.expect(pm.response.responseTime).to.be.below(5000);"
                ]
              }
            }
          ]
        },
        {
          "name": "0.2 Reset Database & Create Test Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reset\": true,\n  \"createAdmin\": true,\n  \"createBoutiques\": 3,\n  \"createArticles\": 10,\n  \"createVentes\": 20\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/test/setup",
              "host": ["{{baseUrl}}"],
              "path": ["test", "setup"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Test Data Setup Complete', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('message');",
                  "    pm.expect(jsonData).to.have.property('adminToken');",
                  "    pm.expect(jsonData).to.have.property('testData');",
                  "    ",
                  "    // Store admin token for subsequent tests",
                  "    pm.environment.set('adminToken', jsonData.adminToken);",
                  "    pm.environment.set('testData', JSON.stringify(jsonData.testData));",
                  "    ",
                  "    // Validate test data structure",
                  "    const testData = jsonData.testData;",
                  "    pm.expect(testData).to.have.property('admin');",
                  "    pm.expect(testData).to.have.property('boutiques');",
                  "    pm.expect(testData).to.have.property('articles');",
                  "    pm.expect(testData).to.have.property('ventes');",
                  "    ",
                  "    pm.expect(testData.boutiques).to.be.an('array').that.has.lengthOf(3);",
                  "    pm.expect(testData.articles).to.be.an('array').that.has.lengthOf(10);",
                  "    pm.expect(testData.ventes).to.be.an('array').that.has.lengthOf(20);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üîê 1. Authentification & S√©curit√©",
      "item": [
        {
          "name": "1.1 Register User - Valid Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Test User\",\n  \"email\": \"test{{randomInt}}@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ User Registration Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.equal('Utilisateur cr√©√© avec succ√®s');",
                  "    ",
                  "    // Store user ID for cleanup",
                  "    pm.environment.set('userId', jsonData.userId || 'temp');",
                  "});",
                  "",
                  "pm.test('‚úÖ Password Not Returned', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.not.have.property('password');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.2 Login User - Valid Credentials",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test{{randomInt}}@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Login Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('token');",
                  "    pm.expect(jsonData).to.have.property('role');",
                  "    pm.expect(jsonData).to.have.property('nom');",
                  "    pm.expect(jsonData).to.have.property('mustChangePassword');",
                  "    ",
                  "    // Validate JWT structure",
                  "    const token = jsonData.token;",
                  "    const parts = token.split('.');",
                  "    pm.expect(parts).to.have.lengthOf(3);",
                  "    ",
                  "    // Store token for future requests",
                  "    pm.environment.set('gerantToken', jsonData.token);",
                  "    pm.environment.set('userId', jsonData.id);",
                  "});",
                  "",
                  "pm.test('‚úÖ JWT Payload Validation', function () {",
                  "    const token = pm.response.json().token;",
                  "    const payload = JSON.parse(atob(token.split('.')[1]));",
                  "    pm.expect(payload).to.have.property('id');",
                  "    pm.expect(payload).to.have.property('role');",
                  "    pm.expect(payload).to.have.property('boutique');",
                  "    pm.expect(payload.role).to.be.oneOf(['Admin', 'G√©rant']);",
                  "});",
                  "",
                  "pm.test('‚úÖ Token Expiration', function () {",
                  "    const token = pm.response.json().token;",
                  "    const payload = JSON.parse(atob(token.split('.')[1]));",
                  "    pm.expect(payload).to.have.property('exp');",
                  "    pm.expect(payload.exp).to.be.greaterThan(Date.now() / 1000);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.3 Login - Invalid Credentials",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"invalid@example.com\",\n  \"password\": \"wrongpassword\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Invalid Credentials Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(401);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Identifiants invalides');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.4 Login - Missing Fields",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\"\n  // password missing\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Missing Fields Validation', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('password');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.5 Create Manager (Admin Only)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Manager Test\",\n  \"email\": \"manager{{randomInt}}@example.com\",\n  \"password\": \"password123\",\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/create-manager",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "create-manager"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Manager Creation Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Compte G√©rant cr√©√© avec succ√®s');",
                  "    pm.expect(jsonData).to.have.property('userId');",
                  "});",
                  "",
                  "pm.test('‚úÖ Email Sent Confirmation', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('email');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.6 Create Manager - Unauthorized (G√©rant)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Manager Test\",\n  \"email\": \"manager2@example.com\",\n  \"password\": \"password123\",\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/create-manager",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "create-manager"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Unauthorized Manager Creation', function () {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Acc√®s refus√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.7 Get Users List (Admin)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/users",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "users"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Users List Retrieved', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    if (jsonData.length > 0) {",
                  "        const user = jsonData[0];",
                  "        pm.expect(user).to.have.property('_id');",
                  "        pm.expect(user).to.have.property('nom');",
                  "        pm.expect(user).to.have.property('email');",
                  "        pm.expect(user).to.have.property('role');",
                  "        pm.expect(user).to.have.property('active');",
                  "        pm.expect(user).to.not.have.property('password');",
                  "        pm.expect(user.role).to.be.oneOf(['Admin', 'G√©rant']);",
                  "    }",
                  "});",
                  "",
                  "pm.test('‚úÖ Deleted Users Filtered', function () {",
                  "    const jsonData = pm.response.json();",
                  "    jsonData.forEach(user => {",
                  "        pm.expect(user.deleted).to.not.equal(true);",
                  "    });",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.8 Get Users List - Unauthorized (G√©rant)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/users",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "users"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Unauthorized Users List Access', function () {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Acc√®s refus√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.9 Change Password - Valid",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"currentPassword\": \"password123\",\n  \"newPassword\": \"newpassword456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/change-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "change-password"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Password Change Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('modifi√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.10 Change Password - Wrong Current Password",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"currentPassword\": \"wrongpassword\",\n  \"newPassword\": \"newpassword456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/change-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "change-password"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Wrong Current Password Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('mot de passe actuel');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.11 Forgot Password",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test{{randomInt}}@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/forgot-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "forgot-password"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Forgot Password Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('email');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "1.12 Update Profile",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Updated Name\",\n  \"email\": \"updated{{randomInt}}@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/profile",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "profile"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Profile Update Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('mis √† jour');",
                  "    pm.expect(jsonData.user.nom).to.equal('Updated Name');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üè¢ 2. Boutiques (Admin)",
      "item": [
        {
          "name": "2.1 Create Boutique - Valid Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Nouvelle Boutique {{randomInt}}\",\n  \"adresse\": \"123 Rue Test, Ville {{randomInt}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/boutiques",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Boutique Creation Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('_id');",
                  "    pm.expect(jsonData).to.have.property('nom');",
                  "    pm.expect(jsonData).to.have.property('adresse');",
                  "    pm.expect(jsonData).to.have.property('active');",
                  "    pm.expect(jsonData.nom).to.include('Nouvelle Boutique');",
                  "    pm.expect(jsonData.active).to.equal(true);",
                  "    ",
                  "    // Store boutique ID for future tests",
                  "    pm.environment.set('boutiqueId', jsonData._id);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2.2 Create Boutique - Missing Fields",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"adresse\": \"123 Rue Test, Ville\"\n  // nom missing\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/boutiques",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Missing Fields Validation', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('nom');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2.3 Get All Boutiques",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/boutiques",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Boutiques List Retrieved', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    if (jsonData.length > 0) {",
                  "        const boutique = jsonData[0];",
                  "        pm.expect(boutique).to.have.property('_id');",
                  "        pm.expect(boutique).to.have.property('nom');",
                  "        pm.expect(boutique).to.have.property('adresse');",
                  "        pm.expect(boutique).to.have.property('active');",
                  "    }",
                  "});",
                  "",
                  "pm.test('‚úÖ Performance Check', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2.4 Get Boutique by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/boutiques/{{boutiqueId}}",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques", "{{boutiqueId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Boutique Retrieved by ID', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('_id');",
                  "    pm.expect(jsonData).to.have.property('nom');",
                  "    pm.expect(jsonData).to.have.property('adresse');",
                  "    pm.expect(jsonData._id).to.equal(pm.environment.get('boutiqueId'));",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2.5 Update Boutique",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Boutique Modifi√©e {{randomInt}}\",\n  \"adresse\": \"456 Rue Modifi√©e, Ville {{randomInt}}\",\n  \"active\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/boutiques/{{boutiqueId}}",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques", "{{boutiqueId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Boutique Update Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('_id');",
                  "    pm.expect(jsonData.nom).to.include('Boutique Modifi√©e');",
                  "    pm.expect(jsonData.adresse).to.include('456 Rue');",
                  "    pm.expect(jsonData.active).to.equal(false);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2.6 Update Boutique - Invalid ID",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Boutique Modifi√©e\",\n  \"adresse\": \"456 Rue Modifi√©e, Ville\",\n  \"active\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/boutiques/invalid_id",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques", "invalid_id"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Invalid ID Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('ID fourni n'est pas valide');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2.7 Delete Boutique",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/boutiques/{{boutiqueId}}",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques", "{{boutiqueId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Boutique Deletion Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('supprim√©e');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "2.8 Get Boutique - After Deletion",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/boutiques/{{boutiqueId}}",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques", "{{boutiqueId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Deleted Boutique Not Found', function () {",
                  "    pm.expect(pm.response.code).to.equal(404);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('introuvable');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üì¶ 3. Articles (Admin & G√©rant)",
      "item": [
        {
          "name": "3.1 Create Article - Valid Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"T-shirt Test {{randomInt}}\",\n  \"prixAchat\": 10.00,\n  \"prixVente\": 20.00,\n  \"quantite\": 50,\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Article Creation Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('_id');",
                  "    pm.expect(jsonData).to.have.property('nom');",
                  "    pm.expect(jsonData).to.have.property('prixAchat');",
                  "    pm.expect(jsonData).to.have.property('prixVente');",
                  "    pm.expect(jsonData).to.have.property('quantite');",
                  "    pm.expect(jsonData).to.have.property('boutique');",
                  "    pm.expect(jsonData.nom).to.include('T-shirt Test');",
                  "    pm.expect(jsonData.prixAchat).to.equal(10);",
                  "    pm.expect(jsonData.prixVente).to.equal(20);",
                  "    pm.expect(jsonData.quantite).to.equal(50);",
                  "    ",
                  "    // Store article ID for future tests",
                  "    pm.environment.set('articleId', jsonData._id);",
                  "});",
                  "",
                  "pm.test('‚úÖ Price Validation - Vente > Achat', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.prixVente).to.be.greaterThan(jsonData.prixAchat);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.2 Create Article - Invalid Price (Vente < Achat)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Article Invalid\",\n  \"prixAchat\": 20.00,\n  \"prixVente\": 15.00,\n  \"quantite\": 10,\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Invalid Price Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('prix de vente doit √™tre sup√©rieur');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.3 Create Article - Missing Boutique",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Article Sans Boutique\",\n  \"prixAchat\": 10.00,\n  \"prixVente\": 20.00,\n  \"quantite\": 50\n  // boutique missing\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Missing Boutique Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('boutique');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.4 Get All Articles - Admin (All Boutiques)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Admin Articles List (All Boutiques)', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    if (jsonData.length > 0) {",
                  "        const article = jsonData[0];",
                  "        pm.expect(article).to.have.property('_id');",
                  "        pm.expect(article).to.have.property('nom');",
                  "        pm.expect(article).to.have.property('prixAchat');",
                  "        pm.expect(article).to.have.property('prixVente');",
                  "        pm.expect(article).to.have.property('quantite');",
                  "        pm.expect(article).to.have.property('boutique');",
                  "        ",
                  "        // Admin should see articles from all boutiques",
                  "        pm.expect(article.boutique).to.be.an('object');",
                  "    }",
                  "});",
                  "",
                  "pm.test('‚úÖ Performance Check', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.5 Get All Articles - G√©rant (Filtered by Boutique)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ G√©rant Articles List (Filtered)', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    // G√©rant should only see articles from their boutique",
                  "    if (jsonData.length > 0) {",
                  "        jsonData.forEach(article => {",
                  "            pm.expect(article.boutique).to.not.be.null;",
                  "        });",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.6 Get Article by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles/{{articleId}}",
              "host": ["{{baseUrl}}"],
              "path": ["articles", "{{articleId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Article Retrieved by ID', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('_id');",
                  "    pm.expect(jsonData).to.have.property('nom');",
                  "    pm.expect(jsonData).to.have.property('prixAchat');",
                  "    pm.expect(jsonData).to.have.property('prixVente');",
                  "    pm.expect(jsonData).to.have.property('quantite');",
                  "    pm.expect(jsonData._id).to.equal(pm.environment.get('articleId'));",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.7 Update Article",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"prixVente\": 25.00,\n  \"quantite\": 60\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles/{{articleId}}",
              "host": ["{{baseUrl}}"],
              "path": ["articles", "{{articleId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Article Update Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('_id');",
                  "    pm.expect(jsonData.prixVente).to.equal(25);",
                  "    pm.expect(jsonData.quantite).to.equal(60);",
                  "});",
                  "",
                  "pm.test('‚úÖ Price Validation Maintained', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.prixVente).to.be.greaterThan(jsonData.prixAchat);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.8 Update Article - Invalid Price",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"prixVente\": 5.00  // Inf√©rieur au prixAchat\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles/{{articleId}}",
              "host": ["{{baseUrl}}"],
              "path": ["articles", "{{articleId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Invalid Price Update Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('prix de vente doit √™tre sup√©rieur');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.9 Delete Article",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles/{{articleId}}",
              "host": ["{{baseUrl}}"],
              "path": ["articles", "{{articleId}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Article Deletion Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('supprim√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.10 Transfer Articles Between Boutiques",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sourceId\": \"{{testData.boutiques[0]._id}}\",\n  \"targetId\": \"{{testData.boutiques[1]._id}}\",\n  \"articleIds\": [\"{{testData.articles[0]._id}}\", \"{{testData.articles[1]._id}}\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles/transfer",
              "host": ["{{baseUrl}}"],
              "path": ["articles", "transfer"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Article Transfer Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('transf√©r√©s');",
                  "    pm.expect(jsonData).to.have.property('modifiedCount');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "3.11 Transfer Articles - Missing Fields",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sourceId\": \"{{testData.boutiques[0]._id}}\"\n  // targetId and articleIds missing\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles/transfer",
              "host": ["{{baseUrl}}"],
              "path": ["articles", "transfer"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Missing Transfer Fields Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('boutiques');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üí∞ 4. Ventes (G√©rant)",
      "item": [
        {
          "name": "4.1 Register Sale - Simple",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"articleId\": \"{{testData.articles[0]._id}}\",\n  \"quantiteVendue\": 2\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ventes",
              "host": ["{{baseUrl}}"],
              "path": ["ventes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Simple Sale Registration Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    if (jsonData.length > 0) {",
                  "        const vente = jsonData[0];",
                  "        pm.expect(vente).to.have.property('_id');",
                  "        pm.expect(vente).to.have.property('article');",
                  "        pm.expect(vente).to.have.property('quantite');",
                  "        pm.expect(vente).to.have.property('prixTotal');",
                  "        pm.expect(vente).to.have.property('gerant');",
                  "        pm.expect(vente).to.have.property('boutique');",
                  "        pm.expect(vente.quantite).to.equal(2);",
                  "        ",
                  "        // Validate prixTotal calculation",
                  "        const article = {{testData.articles[0]}};",
                  "        const expectedTotal = article.prixVente * 2;",
                  "        pm.expect(vente.prixTotal).to.equal(expectedTotal);",
                  "        ",
                  "        // Store vente ID for future tests",
                  "        pm.environment.set('venteId', vente._id);",
                  "    }",
                  "});",
                  "",
                  "pm.test('‚úÖ Stock Updated After Sale', function () {",
                  "    // This would require a separate GET request to verify stock update",
                  "    // For now, we assume the transaction worked correctly",
                  "    pm.expect(true).to.be.true;",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.2 Register Sale - Panier Multiple Items",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"panier\": [\n    {\n      \"articleId\": \"{{testData.articles[0]._id}}\",\n      \"quantiteVendue\": 1\n    },\n    {\n      \"articleId\": \"{{testData.articles[1]._id}}\",\n      \"quantiteVendue\": 2\n    },\n    {\n      \"articleId\": \"{{testData.articles[2]._id}}\",\n      \"quantiteVendue\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ventes",
              "host": ["{{baseUrl}}"],
              "path": ["ventes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Panier Sale Registration Success', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    pm.expect(jsonData.length).to.equal(3);",
                  "    ",
                  "    // Validate each item in the panier",
                  "    jsonData.forEach((vente, index) => {",
                  "        pm.expect(vente).to.have.property('quantite');",
                  "        pm.expect(vente).to.have.property('prixTotal');",
                  "        pm.expect(vente).to.have.property('article');",
                  "        pm.expect(vente).to.have.property('gerant');",
                  "    });",
                  "    ",
                  "    // Validate quantities match panier",
                  "    pm.expect(jsonData[0].quantite).to.equal(1);",
                  "    pm.expect(jsonData[1].quantite).to.equal(2);",
                  "    pm.expect(jsonData[2].quantite).to.equal(1);",
                  "});",
                  "",
                  "pm.test('‚úÖ Transaction Atomicity', function () {",
                  "    // All items should be processed or none",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.length).to.equal(3);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.3 Register Sale - Insufficient Stock",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"articleId\": \"{{testData.articles[0]._id}}\",\n  \"quantiteVendue\": 1000  // More than available stock\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ventes",
              "host": ["{{baseUrl}}"],
              "path": ["ventes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Insufficient Stock Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Stock insuffisant');",
                  "    pm.expect(jsonData.message).to.include('Disponible');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.4 Register Sale - Invalid Article ID",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"articleId\": \"invalid_id\",\n  \"quantiteVendue\": 2\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ventes",
              "host": ["{{baseUrl}}"],
              "path": ["ventes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Invalid Article ID Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('ID fourni n'est pas valide');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.5 Register Sale - Missing Article ID",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"quantiteVendue\": 2\n  // articleId missing\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ventes",
              "host": ["{{baseUrl}}"],
              "path": ["ventes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Missing Article ID Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('articleId');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.6 Register Sale - Zero Quantity",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"articleId\": \"{{testData.articles[0]._id}}\",\n  \"quantiteVendue\": 0\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ventes",
              "host": ["{{baseUrl}}"],
              "path": ["ventes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Zero Quantity Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('quantit√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.7 Get Sales History - G√©rant (Filtered)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/ventes/historique",
              "host": ["{{baseUrl}}"],
              "path": ["ventes", "historique"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Sales History Retrieved (G√©rant)', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    if (jsonData.length > 0) {",
                  "        const vente = jsonData[0];",
                  "        pm.expect(vente).to.have.property('_id');",
                  "        pm.expect(vente).to.have.property('article');",
                  "        pm.expect(vente).to.have.property('quantite');",
                  "        pm.expect(vente).to.have.property('prixTotal');",
                  "        pm.expect(vente).to.have.property('gerant');",
                  "        pm.expect(vente).to.have.property('boutique');",
                  "        ",
                  "        // Check nested article object",
                  "        pm.expect(vente.article).to.have.property('_id');",
                  "        pm.expect(vente.article).to.have.property('nom');",
                  "        ",
                  "        // Check nested gerant object",
                  "        pm.expect(vente.gerant).to.have.property('_id');",
                  "        pm.expect(vente.gerant).to.have.property('nom');",
                  "        ",
                  "        // G√©rant should only see their own sales",
                  "        pm.expect(vente.gerant._id).to.equal(pm.environment.get('userId'));",
                  "    }",
                  "});",
                  "",
                  "pm.test('‚úÖ Performance Check', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.8 Get Sales History - Admin (All Sales)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/ventes/historique",
              "host": ["{{baseUrl}}"],
              "path": ["ventes", "historique"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Sales History Retrieved (Admin)', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    if (jsonData.length > 0) {",
                  "        const vente = jsonData[0];",
                  "        pm.expect(vente).to.have.property('_id');",
                  "        pm.expect(vente).to.have.property('article');",
                  "        pm.expect(vente).to.have.property('quantite');",
                  "        pm.expect(vente).to.have.property('prixTotal');",
                  "        pm.expect(vente).to.have.property('gerant');",
                  "        pm.expect(vente).to.have.property('boutique');",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.9 Get Sales Logs (Admin Only)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/ventes/logs",
              "host": ["{{baseUrl}}"],
              "path": ["ventes", "logs"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Sales Logs Retrieved', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('logs');",
                  "    pm.expect(jsonData.logs).to.be.an('array');",
                  "    ",
                  "    if (jsonData.logs.length > 0) {",
                  "        const log = jsonData.logs[0];",
                  "        pm.expect(log).to.include('SUIVI VENTE');",
                  "        pm.expect(log).to.include('ID:');",
                  "        pm.expect(log).to.include('Article:');",
                  "        pm.expect(log).to.include('Qt√©:');",
                  "        pm.expect(log).to.include('Vendeur:');",
                  "        pm.expect(log).to.include('Date:');",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "4.10 Get Sales Logs - Unauthorized (G√©rant)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/ventes/logs",
              "host": ["{{baseUrl}}"],
              "path": ["ventes", "logs"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Unauthorized Sales Logs Access', function () {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Acc√®s refus√©');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üìä 5. Dashboard (Admin)",
      "item": [
        {
          "name": "5.1 Get Dashboard Stats - Monthly",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/dashboard/stats?range=monthly",
              "host": ["{{baseUrl}}"],
              "path": ["dashboard", "stats"],
              "query": [
                {
                  "key": "range",
                  "value": "monthly"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Dashboard Stats (Monthly)', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    ",
                  "    // Check KPIs",
                  "    pm.expect(jsonData).to.have.property('totalCA');",
                  "    pm.expect(jsonData).to.have.property('totalBenefice');",
                  "    pm.expect(jsonData).to.have.property('totalArticles');",
                  "    pm.expect(jsonData).to.have.property('totalVentes');",
                  "    pm.expect(jsonData).to.have.property('dailySales');",
                  "    pm.expect(jsonData).to.have.property('dailyOrders');",
                  "    ",
                  "    // Check data types",
                  "    pm.expect(jsonData.totalCA).to.be.a('number');",
                  "    pm.expect(jsonData.totalBenefice).to.be.a('number');",
                  "    pm.expect(jsonData.totalArticles).to.be.a('number');",
                  "    pm.expect(jsonData.totalVentes).to.be.a('number');",
                  "    pm.expect(jsonData.dailySales).to.be.a('number');",
                  "    pm.expect(jsonData.dailyOrders).to.be.a('number');",
                  "    ",
                  "    // Check graphiques",
                  "    pm.expect(jsonData).to.have.property('salesProfit');",
                  "    pm.expect(jsonData.salesProfit).to.have.property('categories');",
                  "    pm.expect(jsonData.salesProfit).to.have.property('series');",
                  "    pm.expect(jsonData.salesProfit.categories).to.be.an('array');",
                  "    pm.expect(jsonData.salesProfit.series).to.be.an('array');",
                  "    ",
                  "    // Check performance data",
                  "    pm.expect(jsonData).to.have.property('performanceGerants');",
                  "    pm.expect(jsonData.performanceGerants).to.be.an('array');",
                  "    pm.expect(jsonData).to.have.property('performanceBoutiques');",
                  "    pm.expect(jsonData.performanceBoutiques).to.be.an('array');",
                  "    ",
                  "    // Check stock status",
                  "    pm.expect(jsonData).to.have.property('stockBoutiques');",
                  "    pm.expect(jsonData.stockBoutiques).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('‚úÖ Performance Check', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "5.2 Get Dashboard Stats - Yearly",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/dashboard/stats?range=yearly",
              "host": ["{{baseUrl}}"],
              "path": ["dashboard", "stats"],
              "query": [
                {
                  "key": "range",
                  "value": "yearly"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Dashboard Stats (Yearly)', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    ",
                  "    // Check yearly-specific data",
                  "    if (jsonData.salesProfit && jsonData.salesProfit.categories) {",
                  "        pm.expect(jsonData.salesProfit.categories.length).to.equal(12);",
                  "        pm.expect(jsonData.salesProfit.categories[0]).to.equal('Jan');",
                  "        pm.expect(jsonData.salesProfit.categories[11]).to.equal('D√©c');",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "5.3 Get Dashboard Stats - Default (Monthly)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/dashboard/stats",
              "host": ["{{baseUrl}}"],
              "path": ["dashboard", "stats"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Dashboard Stats (Default)', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    ",
                  "    // Should default to monthly",
                  "    pm.expect(jsonData).to.have.property('salesProfit');",
                  "    pm.expect(jsonData.salesProfit).to.have.property('categories');",
                  "    pm.expect(jsonData.salesProfit.categories).to.be.an('array');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "5.4 Get Dashboard Stats - Invalid Range",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/dashboard/stats?range=invalid",
              "host": ["{{baseUrl}}"],
              "path": ["dashboard", "stats"],
              "query": [
                {
                  "key": "range",
                  "value": "invalid"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Invalid Range Defaults to Monthly', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    ",
                  "    // Should default to monthly even with invalid range",
                  "    pm.expect(jsonData).to.have.property('salesProfit');",
                  "    pm.expect(jsonData.salesProfit).to.have.property('categories');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üîí 6. S√©curit√© & Validation",
      "item": [
        {
          "name": "6.1 Unauthorized Access Test",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Unauthorized Access Denied', function () {",
                  "    pm.expect(pm.response.code).to.equal(401);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Non autoris√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6.2 Invalid Token Test",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer invalid_token"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Invalid Token Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(401);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('token a √©chou√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6.3 Expired Token Test",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjEyMzQ1Njc4OTAiLCJyb2xlIjoiQWRtaW4iLCJpYXQiOjE2MDk0NTkzNjAsImV4cCI6MTYwOTQ1OTM2MH0.invalid"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Expired Token Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(401);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('token a √©chou√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6.4 Access Denied - Wrong Role (G√©rant ‚Üí Admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Boutique Interdite\",\n  \"adresse\": \"Interdit\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/boutiques",
              "host": ["{{baseUrl}}"],
              "path": ["boutiques"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Role-based Access Control Works', function () {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Acc√®s refus√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6.5 Access Denied - Wrong Role (Admin ‚Üí G√©rant Only)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/gerant/dashboard",
              "host": ["{{baseUrl}}"],
              "path": ["gerant", "dashboard"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Admin Cannot Access G√©rant Dashboard', function () {",
                  "    pm.expect(pm.response.code).to.equal(403);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('Acc√®s refus√©');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6.6 SQL Injection Test",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles?id=' OR '1'='1",
              "host": ["{{baseUrl}}"],
              "path": ["articles"],
              "query": [
                {
                  "key": "id",
                  "value": "' OR '1'='1"
                }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ SQL Injection Protected', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 404, 500]);",
                  "    // Should not return all articles or cause server error",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.not.include('SELECT');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6.7 XSS Injection Test",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"<script>alert('XSS')</script>\",\n  \"prixAchat\": 10.00,\n  \"prixVente\": 20.00,\n  \"quantite\": 50,\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ XSS Injection Protected', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.nom).to.not.include('<script>');",
                  "    pm.expect(jsonData.nom).to.not.include('</script>');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6.8 Mass Assignment Protection",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Article Test\",\n  \"prixAchat\": 10.00,\n  \"prixVente\": 20.00,\n  \"quantite\": 50,\n  \"boutique\": \"{{testData.boutiques[0]._id}}\",\n  \"role\": \"Admin\",  // Should be ignored\n  \"active\": false    // Should be ignored\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Mass Assignment Protected', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.not.have.property('role');",
                  "    pm.expect(jsonData).to.not.have.property('active');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "6.9 Rate Limiting Test (Multiple Requests)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Rate Limiting Check', function () {",
                  "    // This test would require multiple rapid requests",
                  "    // For now, we check that the request succeeds",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "});",
                  "",
                  "pm.test('‚úÖ Response Time Check', function () {",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "‚ö° 7. Performance & Load",
      "item": [
        {
          "name": "7.1 Articles List Performance",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Articles List Performance', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "    ",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    // Performance metrics",
                  "    console.log('Response Time:', pm.response.responseTime, 'ms');",
                  "    console.log('Data Size:', JSON.stringify(jsonData).length, 'bytes');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "7.2 Dashboard Stats Performance",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/dashboard/stats",
              "host": ["{{baseUrl}}"],
              "path": ["dashboard", "stats"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Dashboard Stats Performance', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    pm.expect(pm.response.responseTime).to.be.below(2000);",
                  "    ",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('totalCA');",
                  "    pm.expect(jsonData).to.have.property('salesProfit');",
                  "    ",
                  "    // Performance metrics",
                  "    console.log('Dashboard Response Time:', pm.response.responseTime, 'ms');",
                  "    console.log('Dashboard Data Size:', JSON.stringify(jsonData).length, 'bytes');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "7.3 Multiple Sales Registration Performance",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"panier\": [\n    {\n      \"articleId\": \"{{testData.articles[0]._id}}\",\n      \"quantiteVendue\": 1\n    },\n    {\n      \"articleId\": \"{{testData.articles[1]._id}}\",\n      \"quantiteVendue\": 1\n    },\n    {\n      \"articleId\": \"{{testData.articles[2]._id}}\",\n      \"quantiteVendue\": 1\n    },\n    {\n      \"articleId\": \"{{testData.articles[3]._id}}\",\n      \"quantiteVendue\": 1\n    },\n    {\n      \"articleId\": \"{{testData.articles[4]._id}}\",\n      \"quantiteVendue\": 1\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ventes",
              "host": ["{{baseUrl}}"],
              "path": ["ventes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Multiple Sales Performance', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    pm.expect(pm.response.responseTime).to.be.below(1000);",
                  "    ",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    pm.expect(jsonData.length).to.equal(5);",
                  "    ",
                  "    // Performance metrics",
                  "    console.log('Multiple Sales Response Time:', pm.response.responseTime, 'ms');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üß™ 8. Edge Cases & Error Handling",
      "item": [
        {
          "name": "8.1 Very Large Article Name",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"{{repeat('A', 1000)}}\",\n  \"prixAchat\": 10.00,\n  \"prixVente\": 20.00,\n  \"quantite\": 50,\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Large Input Handling', function () {",
                  "    // Should either succeed or fail gracefully",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 400, 413]);",
                  "    ",
                  "    if (pm.response.code === 201) {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.nom).to.have.length.below(500); // Truncated",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "8.2 Negative Price Values",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Article N√©gatif\",\n  \"prixAchat\": -10.00,\n  \"prixVente\": -5.00,\n  \"quantite\": 50,\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Negative Prices Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('prix');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "8.3 Very Large Quantity",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Article Quantit√© √ânorme\",\n  \"prixAchat\": 10.00,\n  \"prixVente\": 20.00,\n  \"quantite\": 999999999999999999999,\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Large Quantity Handling', function () {",
                  "    // Should handle large numbers gracefully",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 400]);",
                  "    ",
                  "    if (pm.response.code === 201) {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.quantite).to.be.a('number');",
                  "    }",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "8.4 Unicode Characters in Names",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"T-shirt Caf√© & Th√© üçµ\",\n  \"prixAchat\": 10.00,\n  \"prixVente\": 20.00,\n  \"quantite\": 50,\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Unicode Characters Supported', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.nom).to.include('Caf√©');",
                  "    pm.expect(jsonData.nom).to.include('Th√©');",
                  "    pm.expect(jsonData.nom).to.include('üçµ');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "8.5 Empty String Fields",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"\",\n  \"prixAchat\": 0,\n  \"prixVente\": 0,\n  \"quantite\": 0,\n  \"boutique\": \"\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚ùå Empty Fields Rejected', function () {",
                  "    pm.expect(pm.response.code).to.equal(400);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('nom');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "8.6 Database Connection Error Simulation",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/test/db-error",
              "host": ["{{baseUrl}}"],
              "path": ["test", "db-error"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Database Error Handling', function () {",
                  "    // This endpoint should simulate a database error",
                  "    // and return a proper error message",
                  "    pm.expect(pm.response.code).to.be.oneOf([500, 503]);",
                  "    ",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('message');",
                  "    pm.expect(jsonData.message).to.include('base de donn√©es');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üîÑ 9. End-to-End Workflows",
      "item": [
        {
          "name": "9.1 Complete Sales Workflow",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// This would be a collection-level test",
                  "// Testing the complete flow: Article ‚Üí Sale ‚Üí Stock Update ‚Üí Dashboard"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{gerantToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"articleId\": \"{{testData.articles[0]._id}}\",\n  \"quantiteVendue\": 1\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/ventes",
              "host": ["{{baseUrl}}"],
              "path": ["ventes"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Complete Sales Workflow', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    ",
                  "    // This test would verify:",
                  "    // 1. Article exists and has sufficient stock",
                  "    // 2. Sale is recorded",
                  "    // 3. Stock is updated",
                  "    // 4. Dashboard reflects the change",
                  "    // 5. Logs are generated",
                  "    ",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    pm.expect(jsonData.length).to.equal(1);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "9.2 Admin Management Workflow",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"nom\": \"Workflow Test Manager\",\n  \"email\": \"workflow{{randomInt}}@example.com\",\n  \"password\": \"password123\",\n  \"boutique\": \"{{testData.boutiques[0]._id}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/create-manager",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "create-manager"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Admin Management Workflow', function () {",
                  "    pm.expect(pm.response.code).to.equal(201);",
                  "    ",
                  "    // This test would verify:",
                  "    // 1. Manager is created",
                  "    // 2. Email is sent",
                  "    // 3. Manager can login",
                  "    // 4. Manager has correct permissions",
                  "    ",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('cr√©√©');",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "üßπ 10. Cleanup & Teardown",
      "item": [
        {
          "name": "10.1 Delete Test Data",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/test/cleanup",
              "host": ["{{baseUrl}}"],
              "path": ["test", "cleanup"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Test Data Cleanup', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('nettoyage');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "10.2 Verify Cleanup",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/articles",
              "host": ["{{baseUrl}}"],
              "path": ["articles"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('‚úÖ Cleanup Verification', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "    ",
                  "    // Should not contain test data",
                  "    jsonData.forEach(article => {",
                  "        pm.expect(article.nom).to.not.include('Test');",
                  "        pm.expect(article.nom).to.not.include('Workflow');",
                  "    });",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Collection-level pre-request script",
          "// Set random values for test data",
          "pm.globals.set('randomInt', Math.floor(Math.random() * 10000));"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Collection-level test script",
          "// Common validation for all requests",
          "",
          "// Check response time",
          "pm.expect(pm.response.responseTime).to.be.below(5000);",
          "",
          "// Check content type",
          "pm.expect(pm.response.headers.get('Content-Type')).to.include('application/json');",
          "",
          "// Check for server errors",
          "pm.expect(pm.response.code).to.not.be.oneOf([500, 502, 503, 504]);"
        ]
      }
    }
  ]
}
